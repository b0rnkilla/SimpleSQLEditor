<hc:Window
  x:Class="SimpleSQLEditor.Views.StatusLogWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
  xmlns:hc="https://handyorg.github.io/handycontrol"
  xmlns:icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
  xmlns:local="clr-namespace:SimpleSQLEditor.Views"
  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
  Title="Status Log"
  Width="500"
  Height="400"
  MinWidth="300"
  MinHeight="300"
  Style="{StaticResource WindowWin10}"
  SystemBackdropType="Mica"
  mc:Ignorable="d">

  <Grid Margin="5">

    <!--#region ListBox showing log entries-->
    <ListBox
      x:Name="LogListBox"
      Background="{StaticResource DarkMaskBrush}"
      ItemContainerStyle="{StaticResource CustomListBoxItemStyle}"
      ItemsSource="{Binding StatusHistory}"
      ScrollViewer.CanContentScroll="False"
      ScrollViewer.HorizontalScrollBarVisibility="Disabled"
      ScrollViewer.VerticalScrollBarVisibility="Auto"
      SelectedItem="{Binding SelectedEntry, Mode=TwoWay}"
      Style="{StaticResource ListBox.Small}">

      <!--#region Different colors per Level-->
      <ListBox.ItemTemplate>
        <DataTemplate>
          <TextBlock TextWrapping="Wrap">

            <TextBlock.Style>
              <Style TargetType="TextBlock">
                <Setter Property="FontWeight" Value="Normal" />

                <Style.Triggers>
                  <DataTrigger Binding="{Binding Level}" Value="Warning">
                    <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                  </DataTrigger>

                  <DataTrigger Binding="{Binding Level}" Value="Success">
                    <Setter Property="Foreground" Value="{DynamicResource SuccessBrush}" />
                  </DataTrigger>

                  <DataTrigger Binding="{Binding Level}" Value="Error">
                    <Setter Property="Foreground" Value="{DynamicResource DangerBrush}" />
                  </DataTrigger>
                </Style.Triggers>
              </Style>
            </TextBlock.Style>

            <Run Text="[" />
            <Run Text="{Binding Timestamp, StringFormat=HH:mm:ss}" />
            <Run Text="] " />
            <Run Text="{Binding Message}" />
          </TextBlock>
        </DataTemplate>
      </ListBox.ItemTemplate>
      <!--#endregion-->

      <!--#region Copyfunction via ContextMenu or Keybinding-->
      <ListBox.ContextMenu>
        <ContextMenu
          Width="150"
          BorderThickness="1"
          DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
          <MenuItem Command="{Binding CopyCommand}">
            <MenuItem.Header>
              <TextBlock Text="Copy to Clipboard" />
            </MenuItem.Header>
            <MenuItem.Icon>
              <TextBlock Margin="4,0,0,0" Text="⧉" />
            </MenuItem.Icon>
          </MenuItem>
        </ContextMenu>
      </ListBox.ContextMenu>

      <ListBox.InputBindings>
        <KeyBinding
          Key="C"
          Command="{Binding CopyCommand}"
          Modifiers="Control" />
      </ListBox.InputBindings>
      <!--#endregion-->

    </ListBox>
    <!--#endregion-->

  </Grid>
</hc:Window>
